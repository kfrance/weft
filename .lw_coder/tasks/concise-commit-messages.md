---
plan_id: concise-commit-messages
status: done
evaluation_notes: []
git_sha: 69f854e7d020209c65fd1f3c0120704ea0e7ba6f
---

# Concise Commit Messages for Finalize Command

## Objectives

Update the finalize command prompts to generate more concise git commit messages while maintaining completeness. The current prompts allow overly verbose commit bodies, leading to frequent user rejections. This plan implements a structured template with clear length constraints to anchor the LLM toward appropriately concise outputs.

## Requirements & Constraints

### Requirements
- Update both `src/lw_coder/prompts/claude-code/finalize.md` and `src/lw_coder/prompts/droid/finalize.md`
- Replace the current commit message format section with a structured template
- Implement length guidance: aim for 10 lines total in body, maximum 15 lines
- Use soft constraint language (not strict "MUST" requirements)
- Keep template minimal - let the model infer what belongs in optional sections
- Maintain the required plan reference format: `@.lw_coder/tasks/{PLAN_ID}.md`

### Constraints
- Do not add concrete examples to the prompts
- Preserve all other aspects of the finalize workflow (rebase, merge, cleanup steps)
- Maintain compatibility with the haiku model (current default for finalize command)
- Keep the same prompt structure and sandbox awareness sections intact

## Work Items

### 1. Update claude-code finalize prompt
- **File**: `src/lw_coder/prompts/claude-code/finalize.md`
- **Change**: Replace the "Commit message format" section (currently lines 22-38) with the new structured template
- **New format**:
  ```
  **Commit message format:**
  ```
  <short summary> (50-72 chars)

  @.lw_coder/tasks/{PLAN_ID}.md

  [2-3 sentence overview of changes]

  [Optional: Key technical decisions or non-obvious aspects]

  [Optional: Dependencies/Breaking changes]
  ```

  Maximum 10 lines total in body.
  ```
- **Preserve**: The execution instruction that follows ("Execute immediately after generating...")

### 2. Update droid finalize prompt
- **File**: `src/lw_coder/prompts/droid/finalize.md`
- **Change**: Replace the equivalent "Commit message format" section with the same structured template
- **Maintain**: Droid-specific language (e.g., references to "Droid permission prompts")

## Deliverables

1. Updated `src/lw_coder/prompts/claude-code/finalize.md` with concise commit message template
2. Updated `src/lw_coder/prompts/droid/finalize.md` with concise commit message template
3. Both prompts use identical structured template for consistency
4. Commit messages generated by finalize command are more concise (10-15 lines typical)

## Out of Scope

- Programmatic validation of commit message length (no post-generation enforcement)
- Retry logic if messages exceed length constraints
- Test coverage for commit message validation
- Examples or concrete sample commit messages in prompts
- Changes to other prompt files (plan.md, code.md, etc.)
- Modifications to the finalize command Python code
- Configuration files for commit message constraints
- Telemetry or logging of commit message metrics

## Unit Tests

No unit tests are required for this change. The modifications are limited to prompt template text files that are loaded at runtime. The existing test coverage for prompt loading (`tests/unit/test_prompt_loader.py`) already validates that prompts load correctly for all supported tools.

## Integration Tests

No integration tests are required. While the effectiveness of the new template could theoretically be tested by running a full finalize workflow with the Claude Code SDK, this would fall under the category of "testing interactive commands" which is explicitly avoided per `docs/BEST_PRACTICES.md`. The template changes will be validated manually through normal usage of the finalize command.

Manual validation approach:
- Run `lw_coder finalize <plan_path>` after implementing changes
- Observe generated commit message length and structure
- Verify messages are more concise while remaining complete
- Iterate on template wording if needed based on real-world usage
