---
plan_id: remove-subagent-tools-syntax
status: done
evaluation_notes: []
git_sha: a6842a173fb96006e68edcd0b981eeaeed246839
---

# Remove Incorrect Tools Syntax from Subagent YAML Front Matter

## Objectives

Fix subagent tool execution by removing the incorrect `tools: ["*"]` syntax from YAML front matter. Currently, subagents generated by the `code` command cannot execute tools because the `tools: ["*"]` declaration prevents tool access rather than enabling it. By removing this line, subagents will properly inherit tool access from the parent Claude Code agent.

## Requirements & Constraints

### Requirements

1. Remove the `tools: ["*"]` line from both subagent YAML front matter templates in `_write_sub_agents` function
2. Add inline code comments explaining that tool inheritance happens when the `tools:` field is omitted
3. Update test assertions to verify the absence of the `tools:` line instead of its presence
4. Maintain all other YAML front matter fields (name, description, model)
5. Ensure subagents can execute tools after the change

### Constraints

- Must maintain backward compatibility with existing subagent behavior (just fixing broken functionality)
- Must follow project testing best practices from `docs/BEST_PRACTICES.md`
- Must not change any other aspects of subagent generation
- Inline documentation only - no separate documentation files required for this minimal fix

## Work Items

### 1. Update `_write_sub_agents` function in `src/lw_coder/code_command.py`

**Location:** Lines 68-111

**Changes:**
- Remove `tools: ["*"]` line from `code_review_frontmatter` (currently line 89)
- Remove `tools: ["*"]` line from `plan_alignment_frontmatter` (currently line 104)
- Add docstring comment explaining tool inheritance behavior
- Add inline comment in YAML template generation explaining why `tools:` is omitted

**Example of updated front matter template:**
```python
code_review_frontmatter = f"""---
name: code-review-auditor
description: Reviews code changes for quality and compliance
model: {model}
---
# Note: tools: field is intentionally omitted to enable tool inheritance from parent Claude Code agent

{prompts['code_review_auditor']}
"""
```

### 2. Update tests in `tests/test_write_sub_agents.py`

**Location:** Lines 29-61

**Changes:**
- In `test_write_sub_agents_correct_yaml_frontmatter`:
  - Remove assertion checking for `tools: ["*"]` presence (line 50)
  - Remove assertion checking for `tools: ["*"]` presence (line 60)
  - Add assertion verifying `tools:` is NOT present in the YAML
  - Update test docstring to reflect new verification behavior

**Example of updated assertions:**
```python
# Verify tools: is not declared (enables inheritance)
assert 'tools:' not in review_content
assert 'tools:' not in alignment_content
```

## Deliverables

1. Modified `src/lw_coder/code_command.py` with:
   - Removed `tools: ["*"]` lines from both subagent templates
   - Added inline documentation explaining tool inheritance
   - Updated function docstring

2. Modified `tests/test_write_sub_agents.py` with:
   - Updated assertions to verify absence of `tools:` field
   - Updated test docstring to reflect new behavior
   - All tests passing after changes

3. Verified functionality:
   - Tests pass with `uv run pytest tests/test_write_sub_agents.py`
   - Generated subagent files have correct YAML structure without `tools:` field

## Out of Scope

- Integration tests for actual tool execution behavior (future enhancement)
- Separate documentation files explaining tool inheritance
- Creating a `SubAgentConfig` abstraction
- Runtime validation of tool inheritance
- Migration utility for existing subagent files
- Versioning of subagent configuration format

## Test Cases

```gherkin
Feature: Subagent YAML Front Matter Generation

  Scenario: Generate code-review-auditor without tools declaration
    Given the _write_sub_agents function is called with valid prompts
    When the code-review-auditor.md file is generated
    Then the YAML front matter should contain "name: code-review-auditor"
    And the YAML front matter should contain "description: Reviews code changes for quality and compliance"
    And the YAML front matter should contain "model: sonnet"
    And the YAML front matter should NOT contain "tools:"

  Scenario: Generate plan-alignment-checker without tools declaration
    Given the _write_sub_agents function is called with valid prompts
    When the plan-alignment-checker.md file is generated
    Then the YAML front matter should contain "name: plan-alignment-checker"
    And the YAML front matter should contain "description: Verifies implementation aligns with the original plan"
    And the YAML front matter should contain "model: sonnet"
    And the YAML front matter should NOT contain "tools:"

  Scenario: Subagent files enable tool inheritance
    Given subagent YAML front matter is generated without tools: field
    When the subagent is invoked by Claude Code
    Then the subagent should inherit tool access from the parent agent
    And the subagent should be able to execute tools successfully

  Scenario: Test assertions verify absence of tools declaration
    Given the test_write_sub_agents_correct_yaml_frontmatter test
    When the test runs against generated subagent files
    Then the test should verify "tools:" is NOT present in the YAML
    And the test should pass for both code-review-auditor and plan-alignment-checker
```
